<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FibreFlow Chart Debug Tool</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-panel { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error-log { 
            background: #ffebee; 
            border: 1px solid #f44336; 
            padding: 10px; 
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .success-log { 
            background: #e8f5e8; 
            border: 1px solid #4caf50; 
            padding: 10px; 
            border-radius: 4px;
        }
        .test-button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .test-button:hover { background: #1976d2; }
        .status { 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0; 
        }
        .status.error { background: #ffcdd2; border-left: 4px solid #f44336; }
        .status.success { background: #c8e6c9; border-left: 4px solid #4caf50; }
        .status.warning { background: #fff3e0; border-left: 4px solid #ff9800; }
        iframe { 
            width: 100%; 
            height: 600px; 
            border: 1px solid #ccc; 
            border-radius: 4px;
        }
        .test-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üîß FibreFlow Chart Debug Tool</h1>
    <p>Use this tool to test and debug the forwardRef chart error in FibreFlow.</p>

    <div class="debug-panel">
        <h2>üéØ Quick Tests</h2>
        <div>
            <button class="test-button" onclick="testProduction()">Test Production Site</button>
            <button class="test-button" onclick="testLocal()">Test Local Dev</button>
            <button class="test-button" onclick="testCharts()">Test Charts Specifically</button>
            <button class="test-button" onclick="clearLogs()">Clear Logs</button>
        </div>
    </div>

    <div class="debug-panel">
        <h2>üìä Test Results</h2>
        <div id="test-status" class="status warning">
            Click a test button to begin testing...
        </div>
        <div id="error-log" class="error-log" style="display: none;"></div>
        <div id="success-log" class="success-log" style="display: none;"></div>
    </div>

    <div class="test-results">
        <div class="debug-panel">
            <h3>üåê Production Site</h3>
            <iframe id="prod-frame" src="" style="display: none;"></iframe>
            <div id="prod-status">Click "Test Production Site" to load</div>
        </div>

        <div class="debug-panel">
            <h3>üè† Local Development</h3>
            <iframe id="local-frame" src="" style="display: none;"></iframe>
            <div id="local-status">Click "Test Local Dev" to load</div>
        </div>
    </div>

    <div class="debug-panel">
        <h2>üìã Manual Testing Steps</h2>
        <ol>
            <li><strong>Open Browser DevTools</strong> (F12)</li>
            <li><strong>Go to Console Tab</strong></li>
            <li><strong>Clear the console</strong> (Ctrl+L or Clear button)</li>
            <li><strong>Click "Test Production Site"</strong> above</li>
            <li><strong>Watch for errors</strong> that contain "forwardRef" or "Surface.js"</li>
            <li><strong>Navigate to chart pages</strong> using the links that appear</li>
            <li><strong>Report back</strong> with exact error messages</li>
        </ol>
    </div>

    <div class="debug-panel">
        <h2>üîç What to Look For</h2>
        <div class="status error">
            <strong>‚ùå BAD:</strong> "Surface.js:12 Uncaught TypeError: Cannot read properties of undefined (reading 'forwardRef')"
        </div>
        <div class="status success">
            <strong>‚úÖ GOOD:</strong> Charts loading without errors, or graceful error messages with retry buttons
        </div>
        <div class="status warning">
            <strong>‚ö†Ô∏è EXPECTED:</strong> Loading spinners, "Loading chart..." messages, or "Chart failed to load" with retry options
        </div>
    </div>

    <script>
        let errorCount = 0;
        let testResults = {};

        function updateStatus(message, type = 'warning') {
            const status = document.getElementById('test-status');
            status.className = `status ${type}`;
            status.textContent = message;
        }

        function logError(error) {
            errorCount++;
            const errorLog = document.getElementById('error-log');
            errorLog.style.display = 'block';
            errorLog.textContent += `[${new Date().toLocaleTimeString()}] ${error}\n`;
            console.error('Chart Debug:', error);
        }

        function logSuccess(message) {
            const successLog = document.getElementById('success-log');
            successLog.style.display = 'block';
            successLog.textContent += `[${new Date().toLocaleTimeString()}] ‚úÖ ${message}\n`;
            console.log('Chart Debug:', message);
        }

        function clearLogs() {
            document.getElementById('error-log').textContent = '';
            document.getElementById('success-log').textContent = '';
            document.getElementById('error-log').style.display = 'none';
            document.getElementById('success-log').style.display = 'none';
            errorCount = 0;
            updateStatus('Logs cleared. Ready for testing.', 'warning');
        }

        function testProduction() {
            updateStatus('Loading production site...', 'warning');
            const frame = document.getElementById('prod-frame');
            const status = document.getElementById('prod-status');
            
            frame.src = 'https://fibreflow-292c7.web.app/';
            frame.style.display = 'block';
            
            frame.onload = () => {
                logSuccess('Production site loaded');
                status.innerHTML = `
                    <p>‚úÖ Production site loaded successfully!</p>
                    <p><strong>Next steps:</strong></p>
                    <ul>
                        <li><a href="https://fibreflow-292c7.web.app/app/procurement/reports" target="_blank">üìä Test Procurement Reports</a></li>
                        <li><a href="https://fibreflow-292c7.web.app/app/analytics" target="_blank">üìà Test Analytics Dashboard</a></li>
                        <li><a href="https://fibreflow-292c7.web.app/app/dashboard" target="_blank">üè† Test Main Dashboard</a></li>
                    </ul>
                    <p><em>Check browser console for forwardRef errors!</em></p>
                `;
                updateStatus('Production site loaded - check console for errors', 'success');
            };
            
            frame.onerror = (error) => {
                logError(`Production site failed to load: ${error}`);
                updateStatus('Production site failed to load', 'error');
            };
        }

        function testLocal() {
            updateStatus('Loading local development site...', 'warning');
            const frame = document.getElementById('local-frame');
            const status = document.getElementById('local-status');
            
            frame.src = 'http://localhost:5176/';
            frame.style.display = 'block';
            
            frame.onload = () => {
                logSuccess('Local development site loaded');
                status.innerHTML = `
                    <p>‚úÖ Local development site loaded successfully!</p>
                    <p><strong>Next steps:</strong></p>
                    <ul>
                        <li><a href="http://localhost:5176/app/procurement/reports" target="_blank">üìä Test Local Procurement Reports</a></li>
                        <li><a href="http://localhost:5176/app/analytics" target="_blank">üìà Test Local Analytics</a></li>
                        <li><a href="http://localhost:5176/app/dashboard" target="_blank">üè† Test Local Dashboard</a></li>
                    </ul>
                    <p><em>Check browser console for forwardRef errors!</em></p>
                `;
                updateStatus('Local site loaded - check console for errors', 'success');
            };
            
            frame.onerror = (error) => {
                logError(`Local site failed to load: ${error}`);
                updateStatus('Local site failed to load - is dev server running?', 'error');
            };
        }

        function testCharts() {
            updateStatus('Opening chart-specific test pages...', 'warning');
            
            // Open multiple windows to test different chart pages
            const testUrls = [
                'https://fibreflow-292c7.web.app/app/procurement/reports',
                'https://fibreflow-292c7.web.app/app/analytics', 
                'https://fibreflow-292c7.web.app/app/dashboard'
            ];
            
            testUrls.forEach((url, index) => {
                setTimeout(() => {
                    window.open(url, `chart-test-${index}`, 'width=1200,height=800');
                    logSuccess(`Opened chart test window: ${url}`);
                }, index * 1000);
            });
            
            updateStatus('Chart test windows opened - check each for forwardRef errors!', 'success');
        }

        // Monitor for any errors on this page
        window.onerror = (message, source, lineno, colno, error) => {
            if (message.includes('forwardRef') || message.includes('Surface.js')) {
                logError(`FORWARDREF ERROR DETECTED: ${message} at ${source}:${lineno}`);
                updateStatus('‚ùå ForwardRef error detected!', 'error');
            }
            return false;
        };

        // Initialize
        updateStatus('Debug tool ready. Click a test button to begin.', 'warning');
        logSuccess('FibreFlow Chart Debug Tool initialized');
    </script>
</body>
</html>