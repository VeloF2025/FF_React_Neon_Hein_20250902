<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contractor Import Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Contractor Import System Test</h1>
    <p>Testing the contractor import functionality with fallback services.</p>
    
    <div id="results"></div>
    
    <button onclick="testServiceLoading()">Test Service Loading</button>
    <button onclick="testValidation()">Test Validation</button>
    <button onclick="testCsvTemplate()">Download CSV Template</button>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(message, isSuccess = true) {
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }
        
        async function testServiceLoading() {
            try {
                addResult('Testing service loading with fallback...');
                
                // Simulate the service loading logic
                const fallbackServices = [
                    'Fibre Installation',
                    'Network Maintenance', 
                    'Customer Premise Equipment',
                    'Site Survey',
                    'Project Management',
                    'Trenching',
                    'Ducting Installation',
                    'Road Crossing',
                    'Reinstatement',
                    'Civil Construction',
                    'Fibre Splicing',
                    'Network Testing',
                    'Equipment Installation',
                    'Optical Equipment Maintenance',
                    'Network Commissioning'
                ];
                
                addResult(`✅ Loaded ${fallbackServices.length} fallback services successfully`);
                addResult(`Services: ${fallbackServices.slice(0, 5).join(', ')}... (${fallbackServices.length - 5} more)`);
                
            } catch (error) {
                addResult(`❌ Service loading failed: ${error.message}`, false);
            }
        }
        
        async function testValidation() {
            try {
                addResult('Testing contractor data validation...');
                
                const testContractor = {
                    companyName: 'Test Company Ltd',
                    contactPerson: 'John Doe',
                    email: 'john@testcompany.co.za',
                    registrationNumber: '2021/123456/07',
                    phone: '0123456789',
                    businessType: 'Pty Ltd',
                    services: ['Fibre Installation', 'Network Maintenance'],
                    province: 'Gauteng',
                    regionOfOperations: ['Gauteng', 'Western Cape']
                };
                
                // Basic validation checks
                const requiredFields = ['companyName', 'contactPerson', 'email', 'registrationNumber'];
                const missingFields = requiredFields.filter(field => !testContractor[field]);
                
                if (missingFields.length === 0) {
                    addResult('✅ All required fields present');
                } else {
                    addResult(`❌ Missing required fields: ${missingFields.join(', ')}`, false);
                }
                
                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (emailRegex.test(testContractor.email)) {
                    addResult('✅ Email format valid');
                } else {
                    addResult('❌ Invalid email format', false);
                }
                
                // Business type validation
                const validBusinessTypes = ['Pty Ltd', 'CC', 'Trust', 'Sole Proprietor'];
                if (validBusinessTypes.includes(testContractor.businessType)) {
                    addResult('✅ Business type valid');
                } else {
                    addResult('❌ Invalid business type', false);
                }
                
                // Province validation
                const validProvinces = ['Eastern Cape', 'Free State', 'Gauteng', 'KwaZulu-Natal', 'Limpopo', 'Mpumalanga', 'Northern Cape', 'North West', 'Western Cape'];
                if (validProvinces.includes(testContractor.province)) {
                    addResult('✅ Province valid');
                } else {
                    addResult('❌ Invalid province', false);
                }
                
                addResult('✅ Validation test completed');
                
            } catch (error) {
                addResult(`❌ Validation test failed: ${error.message}`, false);
            }
        }
        
        function testCsvTemplate() {
            try {
                addResult('Generating CSV template...');
                
                const headers = [
                    'Company Name*', 'Trading Name', 'Contact Person*', 'Email*', 
                    'Registration Number*', 'Phone', 'Business Type*', 'Services', 
                    'Website', 'Address 1', 'Address 2', 'Suburb', 'City', 
                    'Province*', 'Postal Code', 'Country', 'Region of Operations'
                ];
                
                const sampleData = [
                    'Alpha Construction Ltd,Alpha Contractors,John Smith,john@alphaconstruction.com,2021/123456/07,0123456789,Pty Ltd,"Fibre Installation, Network Maintenance",https://www.alphaconstruction.com,123 Main Street,Unit 5A,Sandton,Johannesburg,Gauteng,2196,South Africa,"Gauteng, Western Cape"'
                ];
                
                const csvContent = [
                    headers.join(','),
                    '',
                    '# VALIDATION GUIDE:',
                    '# Business Type (required): Pty Ltd, CC, Trust, Sole Proprietor',
                    '# Services: Choose from available services like Fibre Installation, Network Maintenance, Trenching, Fibre Splicing, etc.',
                    '# Province (required): Eastern Cape, Free State, Gauteng, KwaZulu-Natal, Limpopo, Mpumalanga, Northern Cape, North West, Western Cape',
                    '',
                    '# SAMPLE DATA:',
                    ...sampleData
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'contractor_import_template.csv';
                link.click();
                window.URL.revokeObjectURL(url);
                
                addResult('✅ CSV template downloaded successfully');
                
            } catch (error) {
                addResult(`❌ CSV template generation failed: ${error.message}`, false);
            }
        }
        
        // Auto-run basic tests on page load
        document.addEventListener('DOMContentLoaded', () => {
            addResult('Contractor Import Test Page Loaded');
            addResult('Ready to test contractor import functionality');
        });
    </script>
</body>
</html>